"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,r=Array(t.length);a<t.length;a++)r[a]=t[a];return r}return Array.from(t)}var pfBarChart={config:{barThickness:40,barGutter:8,labelWidth:120,labelHeight:50,labelBaseline:20,labelColor:"black",countColor:"white",chartHeight:500},display:function(t,a){switch(this.chart=t,this.orientation=a,this.getSvgDimensions(),this.createSvg(),this.orientation){case"horizontal":pfHorizonal.create();break;case"vertical":pfVertical.create()}},createSvg:function(){this.svg=d3.select(this.chart.el).append("svg").attr("width","100%").attr("height",this.height),this.chart.desc&&this.svg.append("desc").text(this.chart.desc)},createBase:function(){var t=this,a=this.svg.selectAll("g").data(this.chart.data.counts).enter().append("g");return a.append("title").text(function(a,r){return"Data for "+t.getLabel(r)}),a.append("desc").text(function(a,r){return"The number of "+t.getLabel(r)+" is "+a+", which is "+t.getBarSize(a)+"% of the total."}),a},getLabel:function(t){return this.chart.data.labels[t].split(" ")[0]},getSvgDimensions:function(){this.maxSize=Math.max.apply(Math,_toConsumableArray(this.chart.data.counts)),"horizontal"==this.orientation?this.height=this.chart.data.counts.length*(this.config.barThickness+this.config.barGutter):"vertical"==this.orientation&&(this.height=this.config.chartHeight)},getBarSize:function(t){return this.maxSize?t/this.maxSize*100:0}},pfHorizonal={create:function(){var t=this,a=pfBarChart.createBase();return a.append("rect").attr("height",pfBarChart.config.barThickness).attr("width",function(t){return pfBarChart.getBarSize(t)+"%"}).attr("x",pfBarChart.config.labelWidth).attr("y",function(a,r){return t.barY(r)}).attr("fill",function(t,a){return pfBarChart.chart.colors}),a.append("text").text(function(t,a){return pfBarChart.getLabel(a)}).attr("height",pfBarChart.config.barThickness).attr("y",function(a,r){return t.barY(r,pfBarChart.config.labelBaseline)}).attr("fill",pfBarChart.config.labelColor),a.append("text").text(function(t){return t}).attr("height",pfBarChart.config.barThickness).attr("x",pfBarChart.config.labelWidth+pfBarChart.config.barGutter).attr("y",function(a,r){return t.barY(r,pfBarChart.config.labelBaseline)}).attr("fill",pfBarChart.config.countColor),a},barY:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-7;return t*pfBarChart.config.barThickness+t*pfBarChart.config.barGutter+a}},pfVertical={create:function(){var t=this,a=pfBarChart.createBase(),r=d3.scaleLinear().range([pfBarChart.config.chartHeight-pfBarChart.config.labelHeight,0]);return a.attr("transform","translate(40,10)"),a.call(d3.axisLeft(r)),a.append("rect").attr("height",function(a){return t.barHeight(a)+"px"}).attr("width",function(){return t.barWidth()+"%"}).attr("x",function(a,r){return t.barX(r)+"%"}).attr("y",function(a){return t.barY(a)}).attr("fill",function(t,a){return pfBarChart.chart.colors[a]}),a.append("text").text(function(t,a){return pfBarChart.getLabel(a)}).attr("height",pfBarChart.config.barThickness).attr("transform","translate(60,0)").attr("x",function(a,r){return t.barX(r)+"%"}).attr("y",pfBarChart.config.chartHeight-pfBarChart.config.labelHeight/2).attr("fill",pfBarChart.config.labelColor),a},barHeight:function(t){return pfBarChart.getBarSize(t)/100*(pfBarChart.config.chartHeight-pfBarChart.config.labelHeight)},barWidth:function(){return(100-pfBarChart.chart.data.counts.length)/pfBarChart.chart.data.counts.length},barY:function(t){var a=this.barHeight(t);return pfBarChart.config.chartHeight-pfBarChart.config.labelHeight-a},barX:function(t){return t*(this.barWidth()+1)}},siChart={create:function(t,a){var r={};r.el=$("#"+a)[0],r.data=this.processData(t,a),r.colors=this.generateColors(a),pfBarChart.display(r,"horizontal")},processData:function(t,a){var r=[],e=[];for(var i in t.reports)void 0!==t.reports[i][a]&&(r.push(i),e.push(t.reports[i][a]));return{labels:r,counts:e}},generateColors:function(t){return t.includes("error")?"#AD0A0E":t.includes("warning")?"#D3550A":t.includes("review")?"#4E44C2":void 0}};$("#getCurrentData").click(function(){$(this).hide(),$("#fetchingData").show(),$.ajax({url:"actions/get_current_issues.php",success:function(t){$("#fetchingData").hide(),$("#doneFetchingData").show()}})}),$("#selectSite").change(function(){var t=this.value;$("#a_error, #a_warning, #a_review, #aa_error, #aa_warning, #aa_review, #aaa_error, #aaa_warning, #aaa_review").html(""),$(".charts, .pages").removeClass("hide"),$.ajax({url:"actions/get_site_issues.php",datatype:"json",data:{site:t},success:function(t){var a=JSON.parse(t);$(".pages span").html(a.pages),siChart.create(a,"a_error"),siChart.create(a,"a_warning"),siChart.create(a,"a_review"),siChart.create(a,"aa_error"),siChart.create(a,"aa_warning"),siChart.create(a,"aa_review"),siChart.create(a,"aaa_error"),siChart.create(a,"aaa_warning"),siChart.create(a,"aaa_review")}})});