"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}var pfBarChart={config:{barThickness:40,barGutter:8,labelWidth:200,labelHeight:100,labelBaseline:20,labelColor:"black"},display:function(t,e){this.chart=t,this.orientation=e,this.getSvgDimensions(),this.createSvg(),this.createBars(),this.createLabels(),this.createCounts()},createSvg:function(){switch(this.orientation){case"horizontal":this.svg=d3.select(this.chart.el).append("svg").attr("width","100%").attr("height",this.height)}},createBars:function(){var t=this;switch(this.orientation){case"horizontal":return this.svg.selectAll("rect").data(this.chart.data.counts).enter().append("rect").attr("height",this.config.barThickness).attr("width",function(e){return t.getBarSize(e)+"%"}).attr("x",this.config.labelWidth).attr("y",function(e,a){return t.getBarLocation(a)}).attr("fill",function(e,a){return t.chart.colors[a]});case"vertical":return!1}},createLabels:function(){var t=this;return this.svg.selectAll("g").enter().data(this.chart.data.labels).enter().append("text").text(function(t){return t}).attr("height",this.config.barThickness).attr("y",function(e,a){return t.getBarLocation(a,t.config.labelBaseline)}).attr("fill",this.config.labelColor)},createCounts:function(){var t=this;return this.svg.selectAll("g").data(this.chart.data.counts).enter().append("text").text(function(t){return t}).attr("height",this.config.barThickness).attr("x",this.config.labelWidth+this.config.barGutter).attr("y",function(e,a){return t.getBarLocation(a,t.config.labelBaseline)}).attr("fill",this.config.labelColor)},getSvgDimensions:function(){"horizontal"==this.orientation?(this.width=Math.max.apply(Math,_toConsumableArray(this.chart.data.counts)),this.height=this.chart.data.counts.length*(this.config.barThickness+this.config.barGutter)):this.orientation},getBarSize:function(t){return t/this.width*100},getBarLocation:function(t){var e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-7;return t*this.config.barThickness+t*this.config.barGutter+e},getVerticalBarBase:function(t){return this.height-this.getBarSize(t)/100*this.height+this.labelHeight}},siChart={create:function(t,e){var a={};a.el=$("#"+e)[0],a.data=this.processData(t,e),a.colors=this.generateColors(a),pfBarChart.display(a,"horizontal")},processData:function(t,e){var a=[],r=[];for(var i in t.reports)void 0!==t.reports[i][e]&&(a.push(i),r.push(t.reports[i][e]));return{labels:a,counts:r}},generateColors:function(t){var e=t.data.counts.length,a={count:e};return t.colorseed&&(a.seed=t.colorseed),t.hue&&(a.hue=t.hue),randomColor(a)}};$("#getCurrentData").click(function(){$(this).attr("disabled","disabled").html("Fetching current issue data"),$.ajax({url:"actions/get_current_issues.php",success:function(t){$("#getCurrentData").removeClass("btn-primary").addClass("btn-secondary").html("Issue data is up-to-date!")}})}),$("#selectSite").change(function(){var t=this.value;$("#a_issues").html(""),$("#aa_issues").html(""),$("#aaa_issues").html(""),$(".chart, .pages").removeClass("hide"),$.ajax({url:"actions/get_site_issues.php",datatype:"json",data:{site:t},success:function(t){var e=JSON.parse(t);$(".pages span").html(e.pages),siChart.create(e,"a_issues"),siChart.create(e,"aa_issues"),siChart.create(e,"aaa_issues")}})});