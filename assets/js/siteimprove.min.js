"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var a=0,e=Array(t.length);a<t.length;a++)e[a]=t[a];return e}return Array.from(t)}var pfBarChart={config:{barThickness:40,barGutter:8,labelWidth:200,labelHeight:100,labelBaseline:20,labelColor:"black"},display:function(t,a){this.chart=t,this.orientation=a,this.getSvgDimensions(),this.createSvg(),this.createBars(),this.createLabels(),this.createCounts()},createSvg:function(){switch(this.orientation){case"horizontal":this.svg=d3.select(this.chart.el).append("svg").attr("width","100%").attr("height",this.height)}},createBars:function(){var t=this;switch(this.orientation){case"horizontal":return this.svg.selectAll("rect").data(this.chart.data.counts).enter().append("rect").attr("height",this.config.barThickness).attr("width",function(a){return t.getBarSize(a)+"%"}).attr("x",this.config.labelWidth).attr("y",function(a,e){return t.getBarLocation(e)}).attr("fill",function(a,e){return t.chart.colors[e]});case"vertical":return!1}},createLabels:function(){var t=this;return this.svg.selectAll("g").enter().data(this.chart.data.labels).enter().append("text").text(function(t){return t}).attr("height",this.config.barThickness).attr("y",function(a,e){return t.getBarLocation(e,t.config.labelBaseline)}).attr("fill",this.config.labelColor)},createCounts:function(){var t=this;return this.svg.selectAll("g").data(this.chart.data.counts).enter().append("text").text(function(t){return t}).attr("height",this.config.barThickness).attr("x",this.config.labelWidth+this.config.barGutter).attr("y",function(a,e){return t.getBarLocation(e,t.config.labelBaseline)}).attr("fill",this.config.labelColor)},getSvgDimensions:function(){"horizontal"==this.orientation?(this.width=Math.max.apply(Math,_toConsumableArray(this.chart.data.counts)),this.height=this.chart.data.counts.length*(this.config.barThickness+this.config.barGutter)):this.orientation},getBarSize:function(t){return this.width?t/this.width*100:0},getBarLocation:function(t){var a=arguments.length>1&&void 0!==arguments[1]?arguments[1]:-7;return t*this.config.barThickness+t*this.config.barGutter+a},getVerticalBarBase:function(t){return this.height-this.getBarSize(t)/100*this.height+this.labelHeight}},siChart={create:function(t,a){var e={};e.el=$("#"+a)[0],e.data=this.processData(t,a),e.colors=this.generateColors(e),pfBarChart.display(e,"horizontal")},processData:function(t,a){var e=[],r=[];for(var i in t.reports)void 0!==t.reports[i][a]&&(e.push(i),r.push(t.reports[i][a]));return{labels:e,counts:r}},generateColors:function(t){var a=t.data.counts.length,e={count:a};return t.colorseed&&(e.seed=t.colorseed),t.hue&&(e.hue=t.hue),randomColor(e)}};$("#getCurrentData").click(function(){$(this).attr("disabled","disabled").html("Fetching current issue data"),$.ajax({url:"actions/get_current_issues.php",success:function(t){$("#getCurrentData").removeClass("btn-primary").addClass("btn-secondary").html("Issue data is up-to-date!")}})}),$("#selectSite").change(function(){var t=this.value;$("#a_error, #a_warning, #a_review, #aa_error, #aa_warning, #aa_review, #aaa_error, #aaa_warning, #aaa_review").html(""),$(".charts, .pages").removeClass("hide"),$.ajax({url:"actions/get_site_issues.php",datatype:"json",data:{site:t},success:function(t){var a=JSON.parse(t);$(".pages span").html(a.pages),siChart.create(a,"a_error"),siChart.create(a,"a_warning"),siChart.create(a,"a_review"),siChart.create(a,"aa_error"),siChart.create(a,"aa_warning"),siChart.create(a,"aa_review"),siChart.create(a,"aaa_error"),siChart.create(a,"aaa_warning"),siChart.create(a,"aaa_review")}})});